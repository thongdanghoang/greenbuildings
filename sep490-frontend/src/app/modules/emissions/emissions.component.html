<master-layout title="emissions.title">
    <div subtitle>{{ 'emissions.subtitle' | translate }}</div>

    <div
        class=""
        actions
    >
        <ng-container
            *ngTemplateOutlet="addActivityBtn; context: {styleClass: 'block lg:hidden', mobile: true}"
        ></ng-container>
        <ng-container
            *ngTemplateOutlet="addActivityBtn; context: {styleClass: 'hidden lg:block', mobile: false}"
        ></ng-container>
    </div>

    <table-template
        [fetch]="search"
        [criteria]="criteria"
        [columns]="cols"
        [triggerSearch]="searchEvent"
        [captionTemplateRef]="captionTemplateRef"
    />
</master-layout>

<ng-template #captionTemplateRef>
    <form
        [formGroup]="filterFormGroup"
        class="-mx-4 grid grid-cols-4 gap-2.5 lg:mx-0"
    >
        <div class="col-span-4 *:w-full lg:col-span-1">
            <p-multiselect
                [options]="selectableBuildings"
                formControlName="buildings"
                optionLabel="label"
                placeholder="{{ 'emissions.activities.filters.buildings' | translate }}"
                [maxSelectedLabels]="1"
                optionValue="value"
            >
            </p-multiselect>
        </div>
        <div class="col-span-4 *:w-full lg:col-span-1">
            <p-multiselect
                [options]="selectableFactors"
                formControlName="factors"
                optionLabel="label"
                placeholder="{{ 'emissions.activities.filters.factors' | translate }}"
                [maxSelectedLabels]="1"
                optionValue="value"
            >
            </p-multiselect>
        </div>
        <p-iconfield class="col-span-4 *:w-full lg:col-span-1">
            <p-inputicon styleClass="pi pi-search" />
            <input
                (keydown.enter)="onFilter()"
                type="text"
                pInputText
                formControlName="name"
                placeholder="{{ 'emissions.activities.table.header.name' | translate }}"
            />
        </p-iconfield>
        <p-iconfield class="col-span-4 *:w-full lg:col-span-1">
            <p-inputicon styleClass="pi pi-search" />
            <input
                (keydown.enter)="onFilter()"
                type="text"
                pInputText
                formControlName="category"
                placeholder="{{ 'emissions.activities.table.header.category' | translate }}"
            />
        </p-iconfield>
        <div class="col-span-4 flex w-full justify-end gap-2.5">
            <p-button
                severity="danger"
                [label]="'common.revert' | translate"
                icon="pi pi-times"
                outlined
                (onClick)="onResetFilters()"
            />
            <p-button
                severity="primary"
                [label]="'common.search' | translate"
                icon="pi pi-search"
                outlined
                (onClick)="onFilter()"
            />
        </div>
    </form>
</ng-template>

<ng-template
    #activityDescriptionTemplate
    let-rowData
>
    <p class="max-w-96 truncate">{{ rowData.description }}</p>
</ng-template>

<ng-template
    #activityColActions
    let-rowData
>
    <p-button
        icon="pi pi-trash"
        severity="danger"
        [text]="true"
        (onClick)="onDeleteEmissionActivity(rowData.id)"
    />
</ng-template>

<ng-template
    #addActivityBtn
    let-styleClass="styleClass"
    let-mobile="mobile"
>
    <p-button
        [class]="styleClass"
        [label]="mobile ? '' : ('buildingGroup.enterprise.emission.activity.new' | translate)"
        icon="pi pi-plus"
        severity="primary"
        (onClick)="openNewActivityDialog()"
    ></p-button>
</ng-template>
